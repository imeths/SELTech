<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SELTech International - Solar Package Calculator</title>
    
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Google Font (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- 3. PDF Generation Libraries (jsPDF and html2canvas) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Apply the Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple spinner for loading state */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #ffffff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <main class="bg-white w-full max-w-2xl rounded-lg shadow-xl p-6 md:p-8">
        
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-blue-800">SELTech International</h1>
            <p class="text-lg text-gray-600">Find Your Perfect Solar Package</p>
        </header>

        <!-- Step 1: Budget Input -->
        <section id="budgetSection" class="space-y-4">
            
            <!-- Tab Buttons -->
            <div class="flex border-b border-gray-200">
                <button id="budgetTabBtn" class="flex-1 py-2 px-4 text-center font-medium text-white bg-blue-600 rounded-t-lg focus:outline-none">
                    Search by Budget
                </button>
                <button id="kwTabBtn" class="flex-1 py-2 px-4 text-center font-medium text-gray-500 bg-gray-100 rounded-t-lg hover:bg-gray-200 focus:outline-none">
                    Search by Size (kW)
                </button>
            </div>

            <!-- Budget Search Panel -->
            <div id="budgetSearch" class="space-y-4 pt-4">
                <label class="block text-sm font-medium text-gray-700">Select your budget range:</label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input id="range-1" name="budgetRange" type="radio" value="700000" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                        <label for="range-1" class="ml-3 block text-sm font-medium text-gray-700">Under 700,000</label>
                    </div>
                    <div class="flex items-center">
                        <input id="range-2" name="budgetRange" type="radio" value="900000" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                        <label for="range-2" class="ml-3 block text-sm font-medium text-gray-700">Under 900,000</label>
                    </div>
                    <div class="flex items-center">
                        <input id="range-3" name="budgetRange" type="radio" value="1400000" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                        <label for="range-3" class="ml-3 block text-sm font-medium text-gray-700">Under 1,400,000</label>
                    </div>
                    <div class="flex items-center">
                        <input id="range-all" name="budgetRange" type="radio" value="Infinity" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" checked>
                        <label for="range-all" class="ml-3 block text-sm font-medium text-gray-700">Show All Packages</label>
                    </div>
                </div>
                <button id="findPackagesByBudgetBtn"
                        class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Find Packages
                </button>
            </div>

            <!-- kW Search Panel (Hidden by default) -->
            <div id="kwSearch" class="hidden space-y-4 pt-4">
                <div>
                    <label for="kwInput" class="block text-sm font-medium text-gray-700 mb-1">Enter system size (e.g., "3.3" or "5")</label>
                    <input type="text" id="kwInput" name="kwInput"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="e.g., 5">
                </div>
                <button id="findPackagesByKwBtn"
                        class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Find by Size
                </button>
            </div>
        </section>

        <!-- Step 2: Show Packages -->
        <section id="packagesSection" class="hidden mt-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Available Packages</h2>
            <div id="packageList" class="space-y-3">
                <!-- Package items will be injected here by JavaScript -->
            </div>
            <p id="noPackagesMessage" class="text-gray-500 text-center hidden">No packages found for your selection.</p>
            <button id="startOverBtn"
                    class="w-full mt-4 bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-600 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
                Start Over
            </button>
        </section>

        <!-- Step 3: Show Package Details -->
        <section id="detailsSection" class="hidden mt-6">
            
            <!-- This inner div is what we will export to PDF -->
            <div id="packageDetailsContent" class="p-6 border border-gray-200 rounded-lg bg-gray-50 mb-4">
                <h2 id="detail-name" class="text-2xl font-bold text-blue-700 mb-2">Package Name</h2>
                <p id="detail-price" class="text-xl font-semibold text-gray-900 mb-4">Price: 0</p>
                <p id="detail-description" class="text-gray-700 mb-4">Package description goes here.</p>
                
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Products Included:</h3>
                <ul id="detail-products" class="list-disc list-inside text-gray-700 space-y-1">
                    <!-- Product items will be injected here by JavaScript -->
                </ul>
            </div>
            
            <!-- Action Buttons for Details View -->
            <div class="flex flex-col sm:flex-row gap-3">
                <button id="downloadPdfBtn"
                        class="flex-1 bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 flex items-center justify-center gap-2">
                    <span id="downloadBtnText">Download as PDF</span>
                    <div id="downloadSpinner" class="spinner hidden"></div>
                </button>
                <button id="backBtn"
                        class="flex-1 bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-600 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
                    Back to List
                </button>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // ===================================================================
            // === V V V  ADD YOUR SOLAR PACKAGES HERE  V V V ===
            // ===================================================================
            //
            // - 'id': A unique number for each package.
            // - 'name': The name of the package.
            // - 'price': The *total price* of the package (as a number).
            // - 'description': A short description.
            // - 'products': A list of all items included in the package.
            //
            const allPackages = [
                {
                    id: 1,
                    name: "3.3kW System (Chinese)",
                    price: 600000,
                    description: "A reliable 3.3kW system featuring cost-effective Chinese components.",
                    products: [
                        "3.3kW Inverter (Chinese Brand)",
                        "High-efficiency Solar Panels (Chinese Brand)",
                        "Standard Mounting Kit",
                        "Installation Included"
                        // TODO: Update with your specific product details
                    ]
                },
                {
                    id: 2,
                    name: "3.3kW System (Korean)",
                    price: 850000,
                    description: "A premium 3.3kW system featuring high-performance Korean components.",
                    products: [
                        "3.3kW Inverter (Korean Brand)",
                        "Premium Solar Panels (Korean Brand)",
                        "Durable Mounting Kit",
                        "Premium Installation"
                        // TODO: Update with your specific product details
                    ]
                },
                {
                    id: 3,
                    name: "5kW System (Chinese)",
                    price: 900000,
                    description: "A powerful 5kW system with cost-effective Chinese components for larger homes.",
                    products: [
                        "5kW Inverter (Chinese Brand)",
                        "High-efficiency Solar Panels (Chinese Brand)",
                        "Standard Mounting Kit",
                        "Installation Included"
                        // TODO: Update with your specific product details
                    ]
                },
                {
                    id: 4,
                    name: "5kW System (Korean)",
                    price: 1300000,
                    description: "A top-tier 5kW system with premium Korean components for maximum efficiency.",
                    products: [
                        "5kW Inverter (Korean Brand)",
                        "Premium Solar Panels (Korean Brand)",
                        "Durable Mounting Kit",
                        "Premium Installation & Monitoring"
                        // TODO: Update with your specific product details
                    ]
                }
            ];
            // ===================================================================
            // === ^ ^ ^  END OF PACKAGE DATA SECTION  ^ ^ ^ ===
            // ===================================================================


            // --- Get all our HTML elements ---
            const budgetSection = document.getElementById('budgetSection');
            const packagesSection = document.getElementById('packagesSection');
            const detailsSection = document.getElementById('detailsSection');
            
            // Tab and Search Elements
            const budgetTabBtn = document.getElementById('budgetTabBtn');
            const kwTabBtn = document.getElementById('kwTabBtn');
            const budgetSearch = document.getElementById('budgetSearch');
            const kwSearch = document.getElementById('kwSearch');
            
            const findPackagesByBudgetBtn = document.getElementById('findPackagesByBudgetBtn');
            
            const kwInput = document.getElementById('kwInput');
            const findPackagesByKwBtn = document.getElementById('findPackagesByKwBtn');
            
            const packageList = document.getElementById('packageList');
            const noPackagesMessage = document.getElementById('noPackagesMessage');
            
            const startOverBtn = document.getElementById('startOverBtn');
            const backBtn = document.getElementById('backBtn');
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            const downloadBtnText = document.getElementById('downloadBtnText');
            const downloadSpinner = document.getElementById('downloadSpinner');
            
            // --- Store the currently selected package ---
            let currentSelectedPackage = null;

            // --- Tab Switching Logic ---
            budgetTabBtn.addEventListener('click', () => {
                budgetSearch.classList.remove('hidden');
                kwSearch.classList.add('hidden');
                budgetTabBtn.classList.add('bg-blue-600', 'text-white');
                budgetTabBtn.classList.remove('bg-gray-100', 'text-gray-500', 'hover:bg-gray-200');
                kwTabBtn.classList.add('bg-gray-100', 'text-gray-500', 'hover:bg-gray-200');
                kwTabBtn.classList.remove('bg-blue-600', 'text-white');
            });

            kwTabBtn.addEventListener('click', () => {
                kwSearch.classList.remove('hidden');
                budgetSearch.classList.add('hidden');
                kwTabBtn.classList.add('bg-blue-600', 'text-white');
                kwTabBtn.classList.remove('bg-gray-100', 'text-gray-500', 'hover:bg-gray-200');
                budgetTabBtn.classList.add('bg-gray-100', 'text-gray-500', 'hover:bg-gray-200');
                budgetTabBtn.classList.remove('bg-blue-600', 'text-white');
            });


            // --- Function to show packages based on budget range ---
            function findPackagesByBudget() {
                const selectedRange = document.querySelector('input[name="budgetRange"]:checked');
                if (!selectedRange) {
                    // This shouldn't happen as one is checked by default,but as a fallback:
                    noPackagesMessage.classList.remove('hidden');
                    packagesSection.classList.remove('hidden');
                    detailsSection.classList.add('hidden');
                    return;
                }

                const maxBudget = parseFloat(selectedRange.value);
                const filteredPackages = allPackages.filter(pkg => pkg.price <= maxBudget);
                displayPackageList(filteredPackages);
            }

            // --- Function to show packages based on kW input ---
            function findPackagesByKw() {
                const query = kwInput.value.trim().toLowerCase();
                if (!query) {
                    displayPackageList(allPackages); // Show all if input is empty
                    return;
                }
                
                const filteredPackages = allPackages.filter(pkg => 
                    pkg.name.toLowerCase().includes(query)
                );
                displayPackageList(filteredPackages);
            }
            
            // --- Generic function to display a list of packages ---
            function displayPackageList(filteredPackages) {
                packageList.innerHTML = ''; // Clear old list

                if (filteredPackages.length > 0) {
                    filteredPackages.forEach(pkg => {
                        const packageItem = document.createElement('div');
                        packageItem.className = 'p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 hover:shadow-md transition duration-200';
                        packageItem.innerHTML = `
                            <h3 class="text-lg font-semibold text-blue-700">${pkg.name}</h3>
                            <p class="text-gray-600">Price: ${pkg.price.toLocaleString()}</p>
                        `;
                        // Add click listener to show details for this package
                        packageItem.addEventListener('click', () => showPackageDetails(pkg));
                        packageList.appendChild(packageItem);
                    });
                    noPackagesMessage.classList.add('hidden');
                } else {
                    noPackagesMessage.classList.remove('hidden');
                }

                // Show the packages section and hide the others
                budgetSection.classList.add('hidden');
                packagesSection.classList.remove('hidden');
                detailsSection.classList.add('hidden');
            }

            // --- Function to show details of a selected package ---
            function showPackageDetails(pkg) {
                currentSelectedPackage = pkg; // Store for PDF download

                // Populate the details card
                document.getElementById('detail-name').textContent = pkg.name;
                document.getElementById('detail-price').textContent = `Price: ${pkg.price.toLocaleString()}`;
                document.getElementById('detail-description').textContent = pkg.description;
                
                const productList = document.getElementById('detail-products');
                productList.innerHTML = ''; // Clear old products
                pkg.products.forEach(product => {
                    const li = document.createElement('li');
                    li.textContent = product;
                    productList.appendChild(li);
                });

                // Show the details section and hide the packages list
                packagesSection.classList.add('hidden');
                detailsSection.classList.remove('hidden');
            }

            // --- Function to go back to the package list ---
            function showPackageList() {
                detailsSection.classList.add('hidden');
                packagesSection.classList.remove('hidden');
                currentSelectedPackage = null; // Clear selected package
            }
            
            // --- Function to go back to the budget input ---
            function showBudgetInput() {
                detailsSection.classList.add('hidden');
                packagesSection.classList.add('hidden');
                budgetSection.classList.remove('hidden');
                
                // Reset inputs to default state
                kwInput.value = '';
                document.getElementById('range-all').checked = true;
                
                // Reset tabs to default
                budgetTabBtn.click();
            }

            // --- Function to generate and download the PDF ---
            async function generatePDF() {
                if (!currentSelectedPackage) return;

                // Use the jsPDF and html2canvas libraries
                const { jsPDF } = window.jspdf;
                const content = document.getElementById('packageDetailsContent');
                
                // Show loading state
                downloadBtnText.textContent = 'Generating...';
                downloadSpinner.classList.remove('hidden');
                downloadPdfBtn.disabled = true;

                try {
                    // 1. Use html2canvas to capture the content div as an image
                    const canvas = await html2canvas(content, {
                        scale: 2, // Improve resolution
                        useCORS: true
                    });
                    
                    const imgData = canvas.toDataURL('image/png');
                    
                    // 2. Create a new PDF document (A4 size)
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    
                    // Calculate ratio to fit the image on the page
                    const ratio = Math.min((pdfWidth - 20) / imgWidth, (pdfHeight - 20) / imgHeight); // -20 for 10mm margins
                    
                    const imgX = 10; // 10mm margin
                    const imgY = 10; // 10mm margin
                    const imgDisplayWidth = imgWidth * ratio;
                    const imgDisplayHeight = imgHeight * ratio;

                    // Add a title for the PDF
                    pdf.setFontSize(20);
                    pdf.setTextColor(30, 58, 138); // text-blue-800
                    pdf.text("SELTech International", pdfWidth / 2, 15, { align: 'center' });
                    
                    pdf.setFontSize(16);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text("Solar Package Quotation", pdfWidth / 2, 22, { align: 'center' });

                    // Add the image of the package details
                    pdf.addImage(imgData, 'PNG', imgX, 30, imgDisplayWidth, imgDisplayHeight);
                    
                    // 3. Save the PDF
                    const fileName = `SELTech_Package_${currentSelectedPackage.name.replace(/ /g, '_')}.pdf`;
                    pdf.save(fileName);

                } catch (error) {
                    console.error("Error generating PDF:", error);
                    downloadBtnText.textContent = 'Error, Try Again';
                } finally {
                    // Reset button state
                    setTimeout(() => {
                        downloadBtnText.textContent = 'Download as PDF';
                        downloadSpinner.classList.add('hidden');
                        downloadPdfBtn.disabled = false;
                    }, 1000);
                }
            }

            // --- Attach Event Listeners ---
            findPackagesByBudgetBtn.addEventListener('click', findPackagesByBudget);
            findPackagesByKwBtn.addEventListener('click', findPackagesByKw);
            
            startOverBtn.addEventListener('click', showBudgetInput);
            backBtn.addEventListener('click', showPackageList);
            downloadPdfBtn.addEventListener('click', generatePDF);
            
            // Optional: Allow pressing Enter on the kW input
            kwInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    findPackagesByKwBtn.click();
                }
            });

        });
    </script>

</body>
</html>